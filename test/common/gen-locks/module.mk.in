DIR := common/gen-locks

TESTSRC += \
	$(DIR)/test-pthread-lock.c \
	$(DIR)/test-null-lock.c

# for the null locking example, we want to set the right defines at
# compile time
$(DIR)/test-null-lock.o: $(DIR)/test-null-lock.c
	$(Q) "  CC		$@"
	$(E)$(CC) $< $(CFLAGS) -D__GEN_NULL_LOCKING__ -c -o $@

# for the pthread locking example, we use default defines (and thus
# stick with the implicit compile rule), but we need to add an extra lib
# when linking
$(DIR)/test-pthread-lock: $(DIR)/test-pthread-lock.o
	$(Q) "  LD		$@"
	$(E)$(LD) $< $(LDFLAGS) $(LIBS) -lpthread -o $@

MODLDFLAGS_$(DIR) = -lssl -lcrypto
